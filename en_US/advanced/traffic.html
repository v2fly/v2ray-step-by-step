<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Traffic Statistics | V2Ray Beginner&#39;s Guide</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Step-by-step guide for first-timers&#39; using V2Ray.">
    
    <link rel="preload" href="/assets/css/0.styles.1b90a7f8.css" as="style"><link rel="preload" href="/assets/js/app.11f247ac.js" as="script"><link rel="preload" href="/assets/js/2.e676ec79.js" as="script"><link rel="preload" href="/assets/js/68.dd3d79cb.js" as="script"><link rel="prefetch" href="/assets/js/10.4ffdc970.js"><link rel="prefetch" href="/assets/js/100.7c974c86.js"><link rel="prefetch" href="/assets/js/101.5b6fce86.js"><link rel="prefetch" href="/assets/js/102.4146af1c.js"><link rel="prefetch" href="/assets/js/103.8cf25788.js"><link rel="prefetch" href="/assets/js/104.15065e7a.js"><link rel="prefetch" href="/assets/js/105.51b5ba16.js"><link rel="prefetch" href="/assets/js/106.18a4245b.js"><link rel="prefetch" href="/assets/js/11.69c155a3.js"><link rel="prefetch" href="/assets/js/12.4586e087.js"><link rel="prefetch" href="/assets/js/13.551a7f25.js"><link rel="prefetch" href="/assets/js/14.666f2a4c.js"><link rel="prefetch" href="/assets/js/15.bec91889.js"><link rel="prefetch" href="/assets/js/16.cfa20867.js"><link rel="prefetch" href="/assets/js/17.1438f443.js"><link rel="prefetch" href="/assets/js/18.15065ed6.js"><link rel="prefetch" href="/assets/js/19.7936348c.js"><link rel="prefetch" href="/assets/js/20.597905c8.js"><link rel="prefetch" href="/assets/js/21.fb9a9186.js"><link rel="prefetch" href="/assets/js/22.7171a2fa.js"><link rel="prefetch" href="/assets/js/23.eb633efc.js"><link rel="prefetch" href="/assets/js/24.efe1076e.js"><link rel="prefetch" href="/assets/js/25.a6579cfd.js"><link rel="prefetch" href="/assets/js/26.15732875.js"><link rel="prefetch" href="/assets/js/27.5c4bccd7.js"><link rel="prefetch" href="/assets/js/28.c3ed6bfc.js"><link rel="prefetch" href="/assets/js/29.498eb96c.js"><link rel="prefetch" href="/assets/js/3.17b07f63.js"><link rel="prefetch" href="/assets/js/30.bb66ca00.js"><link rel="prefetch" href="/assets/js/31.f4e75936.js"><link rel="prefetch" href="/assets/js/32.3ff04109.js"><link rel="prefetch" href="/assets/js/33.8b071e05.js"><link rel="prefetch" href="/assets/js/34.db8006b5.js"><link rel="prefetch" href="/assets/js/35.f9c0e427.js"><link rel="prefetch" href="/assets/js/36.605f49cc.js"><link rel="prefetch" href="/assets/js/37.abd848e8.js"><link rel="prefetch" href="/assets/js/38.96ac5224.js"><link rel="prefetch" href="/assets/js/39.dc147656.js"><link rel="prefetch" href="/assets/js/4.aa294e3d.js"><link rel="prefetch" href="/assets/js/40.16b8efc5.js"><link rel="prefetch" href="/assets/js/41.7c4a98a6.js"><link rel="prefetch" href="/assets/js/42.ad8fe014.js"><link rel="prefetch" href="/assets/js/43.2ca0d0f6.js"><link rel="prefetch" href="/assets/js/44.b78f507d.js"><link rel="prefetch" href="/assets/js/45.2a2122d2.js"><link rel="prefetch" href="/assets/js/46.54c82a65.js"><link rel="prefetch" href="/assets/js/47.5baa5d78.js"><link rel="prefetch" href="/assets/js/48.32d1228b.js"><link rel="prefetch" href="/assets/js/49.ef859e66.js"><link rel="prefetch" href="/assets/js/5.3765c642.js"><link rel="prefetch" href="/assets/js/50.cc9f3854.js"><link rel="prefetch" href="/assets/js/51.dc15e1ed.js"><link rel="prefetch" href="/assets/js/52.d0f49d7a.js"><link rel="prefetch" href="/assets/js/53.3518a838.js"><link rel="prefetch" href="/assets/js/54.f0662c33.js"><link rel="prefetch" href="/assets/js/55.192fbc60.js"><link rel="prefetch" href="/assets/js/56.ed0f67e4.js"><link rel="prefetch" href="/assets/js/57.bca465b6.js"><link rel="prefetch" href="/assets/js/58.fcedf3b6.js"><link rel="prefetch" href="/assets/js/59.dfc5b378.js"><link rel="prefetch" href="/assets/js/6.c4f6085e.js"><link rel="prefetch" href="/assets/js/60.1d581ebe.js"><link rel="prefetch" href="/assets/js/61.385a5fe0.js"><link rel="prefetch" href="/assets/js/62.d1bb189d.js"><link rel="prefetch" href="/assets/js/63.999409e1.js"><link rel="prefetch" href="/assets/js/64.885cb476.js"><link rel="prefetch" href="/assets/js/65.e955dff3.js"><link rel="prefetch" href="/assets/js/66.48116b73.js"><link rel="prefetch" href="/assets/js/67.4a1543e0.js"><link rel="prefetch" href="/assets/js/69.e1889862.js"><link rel="prefetch" href="/assets/js/7.f9a4d79a.js"><link rel="prefetch" href="/assets/js/70.c2c9e610.js"><link rel="prefetch" href="/assets/js/71.d70dfd73.js"><link rel="prefetch" href="/assets/js/72.100533aa.js"><link rel="prefetch" href="/assets/js/73.26e6f18b.js"><link rel="prefetch" href="/assets/js/74.0650e362.js"><link rel="prefetch" href="/assets/js/75.c0156f05.js"><link rel="prefetch" href="/assets/js/76.df6ac65b.js"><link rel="prefetch" href="/assets/js/77.cd8ccde9.js"><link rel="prefetch" href="/assets/js/78.44c2e514.js"><link rel="prefetch" href="/assets/js/79.6321f68c.js"><link rel="prefetch" href="/assets/js/8.c48fcb6b.js"><link rel="prefetch" href="/assets/js/80.809b19c2.js"><link rel="prefetch" href="/assets/js/81.ca1c314f.js"><link rel="prefetch" href="/assets/js/82.693124ab.js"><link rel="prefetch" href="/assets/js/83.aa098740.js"><link rel="prefetch" href="/assets/js/84.74c5775b.js"><link rel="prefetch" href="/assets/js/85.30897b5d.js"><link rel="prefetch" href="/assets/js/86.b06cedfb.js"><link rel="prefetch" href="/assets/js/87.23131726.js"><link rel="prefetch" href="/assets/js/88.dab2ef95.js"><link rel="prefetch" href="/assets/js/89.35626385.js"><link rel="prefetch" href="/assets/js/9.73750180.js"><link rel="prefetch" href="/assets/js/90.25d56649.js"><link rel="prefetch" href="/assets/js/91.9a75ff45.js"><link rel="prefetch" href="/assets/js/92.f48516bc.js"><link rel="prefetch" href="/assets/js/93.6b879d43.js"><link rel="prefetch" href="/assets/js/94.d350b85c.js"><link rel="prefetch" href="/assets/js/95.a93da06d.js"><link rel="prefetch" href="/assets/js/96.97a4d5a7.js"><link rel="prefetch" href="/assets/js/97.9155fb6c.js"><link rel="prefetch" href="/assets/js/98.9f59c4bd.js"><link rel="prefetch" href="/assets/js/99.d2e59011.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1b90a7f8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en_US/" class="home-link router-link-active"><!----> <span class="site-name">V2Ray Beginner's Guide</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://v2fly.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Official Guide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advanced/traffic.html" class="nav-link">
  zh-CN
</a></li><li class="dropdown-item"><!----> <a href="/en_US/advanced/traffic.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  en-US
</a></li></ul></div></div> <a href="https://github.com/v2fly/v2ray-step-by-step" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://v2fly.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Official Guide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advanced/traffic.html" class="nav-link">
  zh-CN
</a></li><li class="dropdown-item"><!----> <a href="/en_US/advanced/traffic.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  en-US
</a></li></ul></div></div> <a href="https://github.com/v2fly/v2ray-step-by-step" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Preface</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en_US/" aria-current="page" class="sidebar-link">Guide to V2Ray configuration</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en_US/prep/prep" class="sidebar-heading clickable"><span>Before start</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en_US/basics/basics" class="sidebar-heading clickable"><span>Basics</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en_US/advanced/advanced" class="sidebar-heading clickable open"><span>Advanced</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/en_US/advanced/mux.html" class="sidebar-link">Mux</a></li><li><a href="/en_US/advanced/mkcp.html" class="sidebar-link">mKCP</a></li><li><a href="/en_US/advanced/dynamicport.html" class="sidebar-link">Dynamic Port</a></li><li><a href="/en_US/advanced/outboundproxy.html" class="sidebar-link">Proxy Forwarding</a></li><li><a href="/en_US/advanced/httpfake.html" class="sidebar-link">HTTP Obfuscation</a></li><li><a href="/en_US/advanced/tls.html" class="sidebar-link">TLS</a></li><li><a href="/en_US/advanced/websocket.html" class="sidebar-link">WebSocket</a></li><li><a href="/en_US/advanced/wss_and_web.html" class="sidebar-link">WebSocket+TLS+Web</a></li><li><a href="/en_US/advanced/h2.html" class="sidebar-link">HTTP/2</a></li><li><a href="/en_US/advanced/cdn.html" class="sidebar-link">CDN</a></li><li><a href="/en_US/advanced/traffic.html" aria-current="page" class="active sidebar-link">Traffic Statistics</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en_US/advanced/traffic.html#configuration-of-stats" class="sidebar-link">Configuration of Stats</a></li><li class="sidebar-sub-header"><a href="/en_US/advanced/traffic.html#configuration-example" class="sidebar-link">Configuration Example</a></li><li class="sidebar-sub-header"><a href="/en_US/advanced/traffic.html#viewing-the-traffic-stats-data" class="sidebar-link">Viewing the traffic stats data</a></li><li class="sidebar-sub-header"><a href="/en_US/advanced/traffic.html#processing-of-traffic-stats" class="sidebar-link">Processing of Traffic Stats</a></li></ul></li><li><a href="/en_US/advanced/not_recommend.html" class="sidebar-link">Not recommended configurations</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en_US/app/app" class="sidebar-heading clickable"><span>Practical</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en_US/routing/routing" class="sidebar-heading clickable"><span>Routing</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="traffic-statistics"><a href="#traffic-statistics" class="header-anchor">#</a> Traffic Statistics</h1> <p>V2Ray has a traffic recording feature that is not enabled by default. Traffic statistics are divided into three categories: <code>inbound</code>, <code>user</code> and <code>outbound</code> (4.26.0+).</p> <ul><li><code>inbound</code> is the inbound statistics of each inbound in the configuration, and the inbound traffic needs to be recorded according to the <code>tag</code>.</li> <li><code>user</code> is the statistics in the user of the vmess protocol, and the user's <code>email</code> is the basis for statistics and distinction. Users in socks, shadowsocks, http and other protocols do not support being counted.</li> <li><code>outbound</code> refers to the statistics of each outbound outbound in the configuration. Newly added since 4.26.0, the outbound traffic needs to be recorded according to the <code>tag</code>.</li></ul> <h2 id="configuration-of-stats"><a href="#configuration-of-stats" class="header-anchor">#</a> Configuration of Stats</h2> <p>To enable traffic statistic, following items must present in configuraton</p> <ol><li><code>&quot;stats&quot;:{}</code> the existence of the object;</li> <li>The statistical switch in <code>&quot;policy&quot;</code> is true. The switch for global statistics is under <code>&quot;system&quot;</code>, and the switch for user statistics is under <code>&quot;levels&quot;</code>;</li> <li>Global statistics must have a tag in the corresponding inbound and outbound;</li> <li>User statistics must have email in <code>&quot;clients&quot;</code>;</li></ol> <p>To use api to query traffic, you need to ensure that the following configuration exists in the configuration:</p> <ol><li>There is <code>StatsService</code> in the <code>&quot;api&quot;</code> configuration object;</li> <li>The entrance of the dedicated <code>dokodemo-door</code> protocol, the tag is api;</li> <li>There are inboundTag:api -&gt; outboundTag:api rules in routing;</li></ol> <p>Note: The statistical <code>email</code>/<code>tag</code> is the data of the current V2Ray process instance. For example, if statistics are performed on the server, the email written by the client has no meaning to the server; if the statistics are performed on the client, the output is the data of the client itself. .</p> <h2 id="configuration-example"><a href="#configuration-example" class="header-anchor">#</a> Configuration Example</h2> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;stats&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;api&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;services&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;StatsService&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;policy&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;levels&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;0&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;statsUserUplink&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token property">&quot;statsUserDownlink&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;system&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;statsInboundUplink&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">&quot;statsInboundDownlink&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">&quot;statsOutboundUplink&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">&quot;statsOutboundDownlink&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;inbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">3307</span><span class="token punctuation">,</span>
            <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vmess&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;clients&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;auser&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;e731f153-4f31-49d3-9e8f-ff8f396135ef&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;alterId&quot;</span><span class="token operator">:</span> <span class="token number">64</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;buser&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;e731f153-4f31-49d3-9e8f-ff8f396135ee&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;level&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;alterId&quot;</span><span class="token operator">:</span> <span class="token number">64</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;listen&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">10085</span><span class="token punctuation">,</span>
            <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dokodemo-door&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;outbounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;freedom&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;settings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;routing&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;rules&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;inboundTag&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">&quot;api&quot;</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token property">&quot;outboundTag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;api&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;field&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;domainStrategy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AsIs&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="viewing-the-traffic-stats-data"><a href="#viewing-the-traffic-stats-data" class="header-anchor">#</a> Viewing the traffic stats data</h2> <p>Viewing traffic information is one of the functions of <code>v2ctl</code>. Use <code>v2ctl api -h</code> to see query examples. The api dokodemo-door port set in the configuration is the port of the <code>--server</code> parameter.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>v2ctl api <span class="token parameter variable">--server</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1:10085 StatsService.QueryStats<span class="token string">'pattern: &quot;&quot; reset: false'</span>
v2ctl api <span class="token parameter variable">--server</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1:10085 StatsService.GetStats<span class="token string">'name: &quot;inbound&gt;&gt;&gt;statin&gt;&gt;&gt;traffic&gt;&gt;&gt;downlink&quot; reset: false'</span>
</code></pre></div><p>Note that if you are running in the CMD of Windows, the quotation marks inside should be handled specially:</p> <div class="language-cmd extra-class"><pre class="language-text"><code>v2ctl.exe api --server=&quot;127.0.0.1:10085&quot; StatsService.GetStats &quot;name: &quot;&quot;&quot;&quot;inbound&gt;&gt;&gt;statin&gt;&gt;&gt;traffic&gt;&gt;&gt;downlink&quot;&quot;&quot;&quot; reset: false&quot;
</code></pre></div><p>There are two callable APIs:</p> <ul><li><code>QueryStats</code> is used to query matching records. You can use the parameters <code>pattern</code> and <code>reset</code>; leave pattern blank to match all records; reset makes the value of the matched unit zero.</li> <li><code>GetStats</code> is used to record one of them. It accepts <code>name</code> and <code>reset</code>. The name can be constructed by referring to the output result of QueryStats. Reset makes the value of this unit zero.</li></ul> <p>Example of output:</p> <div class="language-text extra-class"><pre class="language-text"><code>$ /usr/local/bin/v2ctl api --server=127.0.0.1:10085 StatsService.GetStats 'name:&quot;inbound&gt;&gt;&gt;ws&gt;&gt;&gt;traffic&gt;&gt;&gt;uplink&quot;'
stat: &amp;lt;
  name: &quot;inbound&gt;&gt;&gt;ws&gt;&gt;&gt;traffic&gt;&gt;&gt;uplink&quot;
  value: 3350713
&gt;
$
$
$ /usr/local/bin/v2ctl api --server=127.0.0.1:10085 StatsService.QueryStats ''
stat: &amp;lt;
  name: &quot;inbound&gt;&gt;&gt;ws&gt;&gt;&gt;traffic&gt;&gt;&gt;uplink&quot;
  value: 3350713
&gt;
stat: &amp;lt;
  name: &quot;inbound&gt;&gt;&gt;ss&gt;&gt;&gt;traffic&gt;&gt;&gt;downlink&quot;
  value: 1704
&gt;
stat: &amp;lt;
  name: &quot;user&gt;&gt;&gt;u3@ws&gt;&gt;&gt;traffic&gt;&gt;&gt;uplink&quot;
  value: 2810759
&gt;
stat: &amp;lt;
  name: &quot;user&gt;&gt;&gt;u9@ss&gt;&gt;&gt;traffic&gt;&gt;&gt;uplink&quot;
  value: 1776
&gt;
stat: &amp;lt;
  name: &quot;inbound&gt;&gt;&gt;ss&gt;&gt;&gt;traffic&gt;&gt;&gt;uplink&quot;
  value: 2276
&gt;
stat: &amp;lt;
  name: &quot;inbound&gt;&gt;&gt;api&gt;&gt;&gt;traffic&gt;&gt;&gt;uplink&quot;
  value: 318
&gt;
stat: &amp;lt;
  name: &quot;user&gt;&gt;&gt;u9@ss&gt;&gt;&gt;traffic&gt;&gt;&gt;downlink&quot;
  value: 1368
&gt;
stat: &amp;lt;
  name: &quot;inbound&gt;&gt;&gt;tcp&gt;&gt;&gt;traffic&gt;&gt;&gt;uplink&quot;
&gt;
stat: &amp;lt;
  name: &quot;inbound&gt;&gt;&gt;tcp&gt;&gt;&gt;traffic&gt;&gt;&gt;downlink&quot;
&gt;
stat: &amp;lt;
  name: &quot;inbound&gt;&gt;&gt;ws&gt;&gt;&gt;traffic&gt;&gt;&gt;downlink&quot;
  value: 130637140
&gt;
stat: &amp;lt;
  name: &quot;inbound&gt;&gt;&gt;api&gt;&gt;&gt;traffic&gt;&gt;&gt;downlink&quot;
  value: 759
&gt;
stat: &amp;lt;
  name: &quot;user&gt;&gt;&gt;u3@ws&gt;&gt;&gt;traffic&gt;&gt;&gt;downlink&quot;
  value: 126944108
&gt;
</code></pre></div><p>The <code>name</code> in the result can be used as the <code>GetStats</code> API to query the value of a single counting unit. Please summarize the composition rule of the name by yourself. I will not discuss it in detail here; the counting unit of value is byte.</p> <h2 id="processing-of-traffic-stats"><a href="#processing-of-traffic-stats" class="header-anchor">#</a> Processing of Traffic Stats</h2> <p>The above configuration allows v2ray to open a query interface of the <code>grpc</code> protocol. In addition to using v2ctl, various programs that support the grpc protocol can be used to query the above values and perform additional processing (such as storage statistics, user billing, chart reports). However, this article will not go into depth. Now that there is a ready-made command line program for <code>v2ctl</code>, we can use a simple shell script awk tool to process it and generate enough readable reports.</p> <p>Try to save the following script to <code>traffic.sh</code>, pay attention to use <code>chmod 755 traffic.sh</code> to grant execution permission. Pay attention to adjust and modify the connection specific port parameters in the line of <code>_APISERVER</code>.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">_APISERVER</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1:10085
<span class="token assign-left variable">_V2CTL</span><span class="token operator">=</span>/usr/local/bin/v2ctl

<span class="token function-name function">apidata</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">ARGS</span><span class="token operator">=</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$1</span> <span class="token operator">==</span> <span class="token string">&quot;reset&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
      <span class="token assign-left variable">ARGS</span><span class="token operator">=</span><span class="token string">&quot;reset: true&quot;</span>
    <span class="token keyword">fi</span>
    <span class="token variable">$_V2CTL</span> api <span class="token parameter variable">--server</span><span class="token operator">=</span><span class="token variable">$_APISERVER</span> StatsService.QueryStats <span class="token string">&quot;<span class="token variable">${ARGS}</span>&quot;</span> <span class="token punctuation">\</span>
    <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{
        if (match($1, /name:/)) {
            f=1; gsub(/^&quot;|link&quot;$/, &quot;&quot;, $2);
            split($2, p,  &quot;&gt;&gt;&gt;&quot;);
            printf &quot;%s:%s-&gt;%s\t&quot;, p[1],p[2],p[4];
        }
        else if (match($1, /value:/) &amp;&amp; f){ f = 0; printf &quot;%.0f\n&quot;, $2; }
        else if (match($0, /^&gt;$/) &amp;&amp; f) { f = 0; print 0; }
    }'</span>
<span class="token punctuation">}</span>

<span class="token function-name function">print_sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">DATA</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$1</span>&quot;</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">PREFIX</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$2</span>&quot;</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">SORTED</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$DATA</span>&quot;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;^<span class="token variable">${PREFIX}</span>&quot;</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-r</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">SUM</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$SORTED</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'
        /-&gt;up/{us+=$2}
        /-&gt;down/{ds+=$2}
        END{
            printf &quot;SUM-&gt;up:\t%.0f\nSUM-&gt;down:\t%.0f\nSUM-&gt;TOTAL:\t%.0f\n&quot;, us, ds, us+ds;
        }'</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token variable">${SORTED}</span><span class="token entity" title="\n">\n</span><span class="token variable">${SUM}</span>&quot;</span> <span class="token punctuation">\</span>
    <span class="token operator">|</span> numfmt <span class="token parameter variable">--field</span><span class="token operator">=</span><span class="token number">2</span> <span class="token parameter variable">--suffix</span><span class="token operator">=</span>B <span class="token parameter variable">--to</span><span class="token operator">=</span>iec <span class="token punctuation">\</span>
    <span class="token operator">|</span> <span class="token function">column</span> <span class="token parameter variable">-t</span>
<span class="token punctuation">}</span>

<span class="token assign-left variable">DATA</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>apidata $1<span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;------------Inbound----------&quot;</span>
print_sum <span class="token string">&quot;<span class="token variable">$DATA</span>&quot;</span> <span class="token string">&quot;inbound&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;-----------------------------&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;------------Outbound----------&quot;</span>
print_sum <span class="token string">&quot;<span class="token variable">$DATA</span>&quot;</span> <span class="token string">&quot;outbound&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;-----------------------------&quot;</span>
<span class="token builtin class-name">echo</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;-------------User------------&quot;</span>
print_sum <span class="token string">&quot;<span class="token variable">$DATA</span>&quot;</span> <span class="token string">&quot;user&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;-----------------------------&quot;</span>
</code></pre></div><p>Example of output</p> <div class="language-text extra-class"><pre class="language-text"><code>$ ./traffic.sh
------------Inbound----------
inbound:ws-&gt;up      0B
inbound:ws-&gt;down    0B
inbound:tcp-&gt;up     47B
inbound:tcp-&gt;down   0B
inbound:kcp-&gt;up     259MB
inbound:kcp-&gt;down   2.4GB
inbound:api-&gt;up     2.0KB
inbound:api-&gt;down   6.6KB
SUM-&gt;up:            259MB
SUM-&gt;down:          2.4GB
SUM-&gt;TOTAL:         2.6GB
-----------------------------

-------------User------------
user:me@kcp-&gt;up    240MB
user:me@kcp-&gt;down  2.3GB
SUM-&gt;up:           240MB
SUM-&gt;down:         2.3GB
SUM-&gt;TOTAL:        2.5GB
-----------------------------
</code></pre></div><p>The script uses the <code>reset</code> parameter to reset the called counting unit. With the watch command, you can view the real-time flow rate per second flowing through v2ray:
<code>watch ./traffic.sh reset</code></p> <h4 id="updates"><a href="#updates" class="header-anchor">#</a> Updates</h4> <ul><li>2019-08-07 Updated the stats script to process the output in Scientific notation</li> <li>2019-08-09 Optimize the traffic script and add the cumulative item of SUM-&gt;TOTAL</li> <li>2020-07-04 Added outbound traffic statistics</li> <li>2020-12-13 Fix v2ctl path, add outbound statistics in script</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/27/2020, 7:38:01 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en_US/advanced/cdn.html" class="prev">
        CDN
      </a></span> <span class="next"><a href="/en_US/advanced/not_recommend.html">
        Not recommended configurations
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.11f247ac.js" defer></script><script src="/assets/js/2.e676ec79.js" defer></script><script src="/assets/js/68.dd3d79cb.js" defer></script>
  </body>
</html>
