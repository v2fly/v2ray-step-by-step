# Mux

Mux 意爲多路複用(multiplexing)，在目前的科學上網工具中僅 V2Ray 有此功能(2018-03-15注：也有其他軟件實現了類似的功能)。它能夠將多條 TCP 連接合併成一條，節省資源，提高併發能力。

聽衆：呃？什麼鬼？

好吧，翻譯成人話就是：

從前，有一個人叫小白，他是騎行愛好者，還是網購狂人、DIY玩家，因此手中有點閒錢總會網購，也喜歡自己買配件組裝自行車。有一次他組裝自行車，在網上騎行之家買了頭盜、手套、碼錶，在x諾專賣店買了指撥、變速器，在x特專賣買了車架，在xx車行買了剎車、踏板、坐墊，在xxx買了輪組、曲柄……

    4 天后……
    9 點小白手機響了，接通，小白：喂，你好。對方：你好，申x快遞，來取一下包裹。小白興興衝地取快遞了。
    20 分鐘後，小白：喂，你好。對方：你好，韻x，過來取快遞。小白又去了。
    又過 15 分鐘，小白：喂，你好。對方：你好，天x，來取快遞。小白又去了。
    又過半個小時，小白：什麼快遞？對方：圓x，快點來。小白心裏：我X。
    10 分鐘後……


如果是你是小白，你累不累？
電腦也差不多，但要乾的活要小白多得多：

    瀏覽器：我要看 V2Ray 配置指南。
    電腦：好，我發起一條 TCP 連接。
    Telegram：我要進 V2Ray 的 Telegram 羣向大佬學習。
    電腦：好，發起了連接。
    瀏覽器：我要看 V2Ray 的手冊。
    電腦：好。
    瀏覽器：我要 Google 搜索 V2Ray 的教程。
    電腦：好。
    瀏覽器：我要……

如果正常的上網連接可以使用上面小白的例子類比的話，那麼，V2Ray 的 Mux 就是：

小黑也與小白一樣自行組裝自行車，也是網購配件，但他無論什麼東西都從xx車行這店裏買。

    4 天后，小黑接起電話：你好。
    對方：你好，順x，來取一下快遞。
    小黑順路買了瓶飲料：大哥，天氣這麼熱，喝點水解解渴。嘿嘿，這箱子太沉，辛苦一下幫幫我搬到屋裏吧。

Mux 實質上不能提高網速，但對併發連接比較有效，如瀏覽圖片較多的網頁，看直播等。從使用效果來說，V2Ray 的 Mux 應該類似於 Shadowsocks 的 TCP Fast Open，因爲兩者的目的都是減小握手時間，只是實現方式不一樣。只是 TCP Fast Open 要設置系統內核才能打開，而 Mux 是純粹在軟件層面上實現，從配置難易度上 V2Ray 較好一些。（2018-09-19 注：剛更新這段話沒多久，V2Ray 就加入了對 TCP Fast Open 的支持，感覺要學不動了～）

## 配置

Mux 只需在客戶端開啓，服務器會自動識別，所以只給客戶端的配置。也就是隻要在 outbound 或 outboundDetour 加入 `"mux": {"enabled": true}` 即可：

```json
{
  "inbounds": [
    {
      "port": 1080, // 監聽端口
      "protocol": "socks", // 入口協議爲 SOCKS 5
      "sniffing": {
        "enabled": true,
        "destOverride": ["http", "tls"]
      },
      "settings": {
        "auth": "noauth"  // 不認證
      }
    }
  ],
  "outbounds": [
    {
      "protocol": "vmess", // 出口協議
      "settings": {
        "vnext": [
          {
            "address": "serveraddr.com", // 服務器地址，請修改爲你自己的服務器 ip 或域名
            "port": 16823,  // 服務器端口
            "users": [
              {
                "id": "b831381d-6324-4d53-ad4f-8cda48b30811",  // 用戶 ID，必須與服務器端配置相同
                "alterId": 64 // 此處的值也應當與服務器相同
              }
            ]
          }
        ]
      },
      "mux": {"enabled": true}
    }
  ]
}

```

#### 更新歷史

- 2018-08-30 修改排版、描述
- 2018-11-17 V4.0+ 配置

