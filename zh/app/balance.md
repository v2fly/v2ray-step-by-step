## 負載均衡

相較於 Shadowsocks 等其它的代理，V2Ray 可以配置多服務器實現負載均衡。此處的負載均衡並非是自動選擇一個延遲或網速最好的服務器進行連接，而是指多個服務器共同承擔網絡流量，從而減小單個服務器的資源佔用及提高服務器的利用率。舉個實際例子，早期的時候 V2Ray 優化稍差，再加上我的小雞特別小，恰恰網絡帶寬非常大，所以每當使用代理全力下載大文件時 VPS 負荷很大，當時 CPU 佔用率都在 80% 以上，時而超過 95%。這樣的情況使得我下載東西時基本都限一下速，就怕商家停了我的機子。後來我突然想到 V2Ray 可以均衡負載，配置好雙服務器均衡之後大流量下載雖然 CPU 佔用率還有 50% 左右，但至少我可以毫無顧忌地大流量下載了。如今過了一年，我的小雞全換了，V2Ray 也沒當時那麼吃性能了，我就再也沒用過負載均衡，但是時不時有人問到，於是獻出本文。

## 配置

實現負載均衡很簡單，在客戶端配置同一個 outbound 的 vnext 寫入各個服務器的配置即可（前提是服務器已經部署好並能正常使用）。例如：
```json
{
  "inbounds": [
  ...
  ],
  "outbound": [
    {
      "protocol": "vmess",
      "settings": {
        "vnext": [
          {
            "address": "address_of_vps1",
            "port": 8232,
            "users": [
              {
                "id": "1ce383ea-13e9-4939-9b1d-20d67135969a",
                "alterId": 64
              }
            ]
          },
          {
            "address": "address_of_vps2",
            "port": 4822,
            "users": [
              {
                "id": "bc172445-4b5e-49b2-a712-12c5295fd26b",
                "alterId": 64
              }
            ]
          }
          // 如果還有更多服務器可繼續添加
        ]
      },
      "streamSettings": {
      ...
      }
    },
    ...
  ]
}
```

## 原理

V2Ray 是以輪詢的方式均衡負載，也就是說當有流量需要通過代理時，首先走第一個 vnext 配置的服務器，有第二個連接就走第二個服務器，接着第三個，以此類推。輪詢完一遍又頭開始輪詢。這樣的方式雖然簡單粗暴，特別是對於擁有多個性能差的 VPS 的人來說比較有用。另外也能減小長時間大流量連接單個 IP 的特徵（由於沒有足夠的樣本，我個人對這樣的條件作爲代理判據持懷疑態度），給自己一個心理安慰。

## 注意事項

如端口、id 這些在 vnext 數組內的配置項可以各不相同，但是它們的傳輸層配置（streamSettings）必須一致。

#### 更新歷史

- 2018-01-03 初版
- 2018-04-05 Update
- 2019-01-13 v4.0+ 配置格式
